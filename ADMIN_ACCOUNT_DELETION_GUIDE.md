# 管理员账户删除处理指南

## 📋 概述

当用户请求删除账户时，管理员需要执行一系列步骤来完全删除用户数据和账户。本指南提供详细的操作步骤。

## 🚨 删除请求的触发情况

用户可能通过以下方式请求删除账户：
1. **应用内删除**：用户在应用中点击"删除账户"
2. **邮件请求**：用户发送邮件请求删除账户
3. **客服联系**：用户通过其他渠道联系要求删除

## 📝 删除前的确认步骤

### 1. 验证用户身份
```
✅ 确认请求来自账户所有者
✅ 验证邮箱地址匹配
✅ 如有疑问，要求额外身份验证
```

### 2. 数据备份（可选）
```
⚠️ 根据公司政策决定是否需要备份
⚠️ 如需备份，设置自动删除时间
⚠️ 确保备份数据的安全性
```

## 🛠️ Supabase 管理员删除步骤

### 步骤 1：登录 Supabase Dashboard
1. 访问 [Supabase Dashboard](https://app.supabase.com)
2. 选择对应的项目
3. 使用管理员账户登录

### 步骤 2：查找用户账户
1. 进入 **Authentication** → **Users**
2. 在搜索框中输入用户邮箱：`co2sou@gmail.com`
3. 找到对应的用户记录

### 步骤 3：删除用户词汇数据
在 **SQL Editor** 中执行以下查询：

```sql
-- 1. 首先查看用户的词汇数据
SELECT COUNT(*) as word_count 
FROM words 
WHERE user_id = (SELECT id FROM auth.users WHERE email = 'co2sou@gmail.com');

-- 2. 删除用户的所有词汇数据
DELETE FROM words 
WHERE user_id = (SELECT id FROM auth.users WHERE email = 'co2sou@gmail.com');

-- 3. 确认删除结果
SELECT COUNT(*) as remaining_words 
FROM words 
WHERE user_id = (SELECT id FROM auth.users WHERE email = 'co2sou@gmail.com');
```

### 步骤 4：删除用户账户
1. 在 **Authentication** → **Users** 中找到用户
2. 点击用户行右侧的 **"..."** 菜单
3. 选择 **"Delete user"**
4. 确认删除操作

### 步骤 5：验证删除完成
```sql
-- 验证用户账户已删除
SELECT * FROM auth.users WHERE email = 'co2sou@gmail.com';
-- 应该返回空结果

-- 验证词汇数据已删除
SELECT COUNT(*) FROM words WHERE user_id = 'USER_UUID_HERE';
-- 应该返回 0
```

## 🔧 命令行删除方法（高级）

如果需要使用 Supabase CLI：

```bash
# 1. 安装 Supabase CLI
npm install -g supabase

# 2. 登录
supabase login

# 3. 连接到项目
supabase link --project-ref YOUR_PROJECT_REF

# 4. 执行删除脚本
supabase db reset --db-url "your-database-url"
```

## 📊 删除确认清单

### 数据删除确认
- [ ] 用户词汇数据已删除
- [ ] 用户账户已从 auth.users 表中删除
- [ ] 相关的会话数据已清理
- [ ] 任何缓存数据已清除

### 系统确认
- [ ] 用户无法再登录应用
- [ ] 用户邮箱可以重新注册（如果允许）
- [ ] 没有残留的用户数据

### 通知确认
- [ ] 向用户发送删除确认邮件
- [ ] 记录删除操作日志
- [ ] 更新用户管理记录

## 📧 删除确认邮件模板

```
主题：账户删除确认 - 多语言词汇学习应用

尊敬的用户，

您的账户删除请求已经处理完成。

删除详情：
- 账户邮箱：co2sou@gmail.com
- 删除时间：[删除时间]
- 删除的数据：所有词汇数据和账户信息

重要提醒：
- 所有数据已永久删除，无法恢复
- 如需重新使用，可以用相同邮箱重新注册
- 如有疑问，请联系客服

感谢您使用我们的服务。

多语言词汇学习团队
```

## 🚨 紧急情况处理

### 误删除恢复
如果发现误删除：
1. **立即停止**进一步的删除操作
2. **检查备份**是否存在可恢复的数据
3. **联系技术团队**评估恢复可能性
4. **通知用户**当前情况和处理进度

### 部分删除失败
如果删除过程中出现错误：
1. **记录错误信息**和失败的步骤
2. **手动清理**残留数据
3. **验证最终状态**确保删除完成
4. **更新操作日志**

## 📋 操作日志模板

```
删除操作记录
================
操作时间：2025-01-22 14:30:00
操作员：[管理员姓名]
用户邮箱：co2sou@gmail.com
用户ID：[用户UUID]

删除步骤：
1. ✅ 验证用户身份
2. ✅ 删除词汇数据（共 X 条记录）
3. ✅ 删除用户账户
4. ✅ 验证删除完成
5. ✅ 发送确认邮件

备注：[任何特殊情况或注意事项]
```

## 🔒 安全注意事项

### 权限控制
- 只有授权管理员可以执行删除操作
- 使用双重验证确认重要操作
- 记录所有管理员操作日志

### 数据保护
- 确保删除操作不影响其他用户
- 验证删除范围的准确性
- 保护敏感信息不被泄露

### 合规要求
- 遵守 GDPR 等数据保护法规
- 在规定时间内完成删除请求
- 保留必要的操作审计记录

## 📞 联系信息

如果在删除过程中遇到问题：
- 技术支持：[技术团队联系方式]
- 紧急联系：[紧急联系方式]
- 文档更新：[文档维护联系方式]

---

**重要提醒**：账户删除是不可逆操作，请务必仔细确认后再执行。
